<?php/* ------------------------------------------------------------------------------------- *  Allow huge memory * *  Since a lot of data is handled, the allowed memory in increased signicantly * ------------------------------------------------------------------------------------- */ini_set('memory_limit', '512M');set_time_limit(300);/* ------------------------------------------------------------------------------------- *  Improve debugging * *  Turn on all debugging for developing purpose * ------------------------------------------------------------------------------------- */error_reporting(E_ALL);ini_set('display_errors', 1);/* ------------------------------------------------------------------------------------- *  Variables * ------------------------------------------------------------------------------------- */$minNumberOfRounds = 3; // STandard 2/* ------------------------------------------------------------------------------------- *  Include the rawdata * ------------------------------------------------------------------------------------- */include 'rawdata_30mars.php';include 'successvariables.php';/* ------------------------------------------------------------------------------------- *  Restructure the csv-data into items * ------------------------------------------------------------------------------------- */// Split every row into an item$investments = explode('', $rawdata);/* ------------------------------------------------------------------------------------- *  Restructure the data and give column names * ------------------------------------------------------------------------------------- */// Take the first investment just to have a previousItem set$lastTargetname = '';$lastTicker = '';foreach ($investments as &$investment) {    $investment = explode(';', $investment);    if (!empty($investment[2])) {        $targetname = $lastTargetname = $investment[2];    } else        $targetname = $lastTargetname;    if (!empty($investment[5]))        $ticker = $lastTicker = $investment[5];    else        $ticker = $lastTicker;    $investment['dealnumber'] = $investment[0];    $investment['date'] = $investment[1];    $investment['targetname'] = $targetname;    $investment['aquirer'] = $investment[3];    $investment['dealtype'] = $investment[4];    $investment['ticker'] = $ticker;    unset($investment[0]);    unset($investment[1]);    unset($investment[2]);    unset($investment[3]);    unset($investment[4]);    unset($investment[5]);}echo 'Total number of rawdata: ' . count($investments) . '<br><br>';/* ------------------------------------------------------------------------------------- *  Filter: Remove companies where the aquirer is unkown * ------------------------------------------------------------------------------------- */echo '<b>Filter: Remove all empty aquirer</b><br>';foreach ($investments as $keyInvestment => $investment) {    if (empty($investment['aquirer']))        unset($investments[$keyInvestment]);}echo 'Total number of rawdata: ' . count($investments) . '<br><br>';// -------------------------------------------------------------------------------------//     RESTRUCTURE THE DATA WITH AQUIRER// -------------------------------------------------------------------------------------$targets = [];foreach ($investments as $investment) {    $targets[$investment['targetname']]['name'] = $investment['targetname'];    $targets[$investment['targetname']]['ticker'] = $investment['ticker'];    $targets[$investment['targetname']]['rounds'][$investment['dealnumber']]['date'] = $investment['date'];    $targets[$investment['targetname']]['rounds'][$investment['dealnumber']]['dealtype'] = $investment['dealtype'];    $targets[$investment['targetname']]['rounds'][$investment['dealnumber']]['aquirers'][] = $investment['aquirer'];}echo 'Number of targets: ' . count($targets) . '<br>';// -------------------------------------------------------------------------------------//     RESTRUCTURE THE DATA WITH AQUIRER// -------------------------------------------------------------------------------------echo '<b>Filter: Remove all targets with less than ' . $minNumberOfRounds . ' rounds </b><br>';foreach ($targets as $keyTarget => $target) {    if (count($target['rounds']) < $minNumberOfRounds)        unset($targets[$keyTarget]);}$targets = array_values($targets);echo 'Number of targets: ' . count($targets) . '<br>';foreach ($targets as &$target) {    $success = 0;    if ($target['ticker'] != 'Unlisted')        $success = 1;    foreach ($target['rounds'] as $round) {        if (in_array($round['dealtype'], $dealTypes['success']))            $success = 1;    }    $target['success'] = $success;}// -------------------------------------------------------------------------------------//     FIND COMPANIES WITHOUT FOLLOWUPS// -------------------------------------------------------------------------------------$aquirersDoingReinvestment = [];foreach ($targets as $targetKey => $target) {    unset($targets[$targetKey]['ticker']);    $targetAquirers = [];    foreach ($target['rounds'] as $round) {        foreach ($round['aquirers'] as $aquirers) {            $targetAquirers[] = $aquirers;        }    }    $targetAquirersCount = array_count_values($targetAquirers);    foreach ($targetAquirersCount as $aquire => $count) {        if ($count > 1) {            $aquirersDoingReinvestment[] = $aquire;        }    }}$aquirersDoingReinvestment = array_values($aquirersDoingReinvestment);echo 'Number of aquirers doing reinvestments: ' . count($aquirersDoingReinvestment);foreach ($targets as $targetKey => $target) {    foreach ($target['rounds'] as $roundKey => $round) {        foreach ($round['aquirers'] as $aquireKey => $aquirers) {            if (!in_array($aquirers, $aquirersDoingReinvestment)) {                unset($targets[$targetKey]['rounds'][$roundKey]['aquirers'][$aquireKey]);            }        }    }}// -------------------------------------------------------------------------------------//     THE RESULT// -------------------------------------------------------------------------------------foreach ($targets as $targetKey => &$target) {    $aquirersWithInsight = [];    $reinvestments = 0;    $reinvestmentsOpportunities = 0;    foreach ($target['rounds'] as $round) {        $reinvestmentsOpportunities = $reinvestmentsOpportunities + count($aquirersWithInsight);        foreach ($round['aquirers'] as $aquirer) {            if (in_array($aquirer, $aquirersWithInsight)) {                $reinvestments++;            } else {                $aquirersWithInsight[] = $aquirer;            }        }    }    $target['reinvestments'] = $reinvestments;    $target['reinvestmentsOpportunities'] = $reinvestmentsOpportunities;    if ($reinvestmentsOpportunities > 0)        $target['reinvestmentsDegree'] = round($reinvestments / $reinvestmentsOpportunities, 2);    else        unset($targets[$targetKey]);}foreach ($targets as &$target) {    $success = 0;    if ($target['ticker'] != 'Unlisted')        $success = 1;    foreach ($target['rounds'] as $round) {        if (in_array($round['dealtype'], $dealTypes['success']))            $success = 1;    }    $target['success'] = $success;}// -------------------------------------------------------------------------------------//     PRINT THE RESULT// -------------------------------------------------------------------------------------echo '<table border="1">';echo '<thead>';echo '<tr>';echo '<th>name</th>';echo '<th>reinvestmentdegree</th>';echo '<th>success</th>';echo '</tr>';echo '</thead>';foreach ($targets as $target) {    echo '<tr>';    echo '<td>' . $target['name'] . '</td>';    echo '<td>' . $target['reinvestmentsDegree'] . '</td>';    echo '<td>' . $target['success'] . '</td>';    echo '</tr>';}echo '</table>';